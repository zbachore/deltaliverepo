steps:
- checkout: self  # ðŸ‘ˆ Ensures the repo content is pulled

- task: UsePythonVersion@0
  inputs:
    versionSpec: '3.x'

- script: |
    pip uninstall -y databricks-cli
    curl -fsSL https://raw.githubusercontent.com/databricks/setup-cli/main/install.sh | bash
    databricks --version
  displayName: 'Install Databricks CLI v2.x'

- script: |
    export DATABRICKS_CONFIG_PROFILE=default
    export DATABRICKS_HOST="$(DATABRICKS_HOST)"
    export DATABRICKS_TOKEN="$(DATABRICKS_TOKEN)"
    echo "Authentication complete"
  displayName: 'Authenticate Databricks CLI via Environment Variables'


- script: |
    echo "Showing root contents..."
    ls -la

    echo "Checking dlt-config-demo folder..."
    ls -la dlt-config-demo

    echo "Checking dlt-scd-demo folder..."
    ls -la dlt-scd-demo
  displayName: 'Debug: Check Folder Structure'
  continueOnError: true

- script: |
    echo "Deploying notebooks to QA..."
    databricks workspace import-dir --profile default --overwrite dlt-config-demo /Shared/QA/dlt-config-demo
    databricks workspace import-dir --profile default --overwrite dlt-scd-demo /Shared/QA/dlt-scd-demo
  displayName: 'Deploy Notebooks to QA Workspace'

